import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { describe, expect, it } from 'vitest';
import { Text } from "../../index.js";
import { createRenderer } from "../index.js";
import { useExtensionContext } from "../../hooks/useExtensionContext.js";
function MyComponent() {
    const context = useExtensionContext();
    return (_jsxs(_Fragment, { children: [_jsx(Text, { testId: "location-text", children: context.location }), _jsx(Text, { testId: "user-email", children: context.user.email }), _jsx(Text, { testId: "user-firstName", children: context.user.firstName }), _jsx(Text, { testId: "user-lastName", children: context.user.lastName }), _jsx(Text, { testId: "portal-id", children: context.portal.id }), _jsx(Text, { testId: "portal-timezone", children: context.portal.timezone }), 'crm' in context && (_jsxs(_Fragment, { children: [_jsx(Text, { testId: "crm-objectId", children: context.crm.objectId }), _jsx(Text, { testId: "crm-objectTypeId", children: context.crm.objectTypeId })] }))] }));
}
describe('mock useExtensionContext', () => {
    it('should provide a CRM mock implementation', () => {
        const { render, findByTestId } = createRenderer('crm.record.tab');
        render(_jsx(MyComponent, {}));
        expect(findByTestId(Text, 'location-text').text).toEqual('crm.record.tab');
        expect(findByTestId(Text, 'user-email').text).toEqual('fake_email@example.com');
        expect(findByTestId(Text, 'user-firstName').text).toEqual('fake_firstName');
        expect(findByTestId(Text, 'user-lastName').text).toEqual('fake_lastName');
        expect(findByTestId(Text, 'portal-id').text).toEqual('123');
        expect(findByTestId(Text, 'portal-timezone').text).toEqual('America/New_York');
        expect(findByTestId(Text, 'crm-objectId').text).toEqual('123');
        expect(findByTestId(Text, 'crm-objectTypeId').text).toEqual('0-1');
    });
    it('should provide a generic mock implementation without CRM properties', () => {
        const { render, findByTestId, maybeFindByTestId } = createRenderer('settings');
        render(_jsx(MyComponent, {}));
        expect(findByTestId(Text, 'location-text').text).toEqual('settings');
        expect(findByTestId(Text, 'user-email').text).toEqual('fake_email@example.com');
        expect(findByTestId(Text, 'user-firstName').text).toEqual('fake_firstName');
        expect(findByTestId(Text, 'user-lastName').text).toEqual('fake_lastName');
        expect(findByTestId(Text, 'portal-id').text).toEqual('123');
        expect(findByTestId(Text, 'portal-timezone').text).toEqual('America/New_York');
        // doesn't have the CRM properties
        expect(maybeFindByTestId(Text, 'crm-objectId')).toBeNull();
        expect(maybeFindByTestId(Text, 'crm-objectTypeId')).toBeNull();
    });
    it('should use the mutated context', () => {
        const newName = 'Gracie';
        const { render, findByTestId, mocks } = createRenderer('settings');
        mocks.context.user.firstName = newName;
        render(_jsx(MyComponent, {}));
        // no longer has the default context value, it has the mutate context
        expect(findByTestId(Text, 'user-firstName').text).toEqual(newName);
        // other properties stay the same
        expect(findByTestId(Text, 'location-text').text).toEqual('settings');
    });
});
